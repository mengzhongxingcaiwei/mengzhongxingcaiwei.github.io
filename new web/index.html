<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>完成情况统计</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 统一的 Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        neutral: '#F3F4F6',
                        'neutral-dark': '#E5E7EB',
                        'text-primary': '#1F2937',
                        'text-secondary': '#6B7280'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'card': '0 2px 4px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.1)',
                        'card-hover': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .student-card {
                @apply flex items-center p-3 rounded-lg transition-all duration-200 cursor-pointer;
            }
            .student-card:hover {
                @apply bg-neutral-dark;
            }
            .student-card.completed {
                @apply bg-green-100 border-l-4 border-green-500;
            }
            .student-avatar {
                @apply w-10 h-10 rounded-full object-cover mr-3;
            }
            .student-name {
                @apply text-text-primary font-medium flex-grow;
            }
            .completed-badge {
                @apply text-green-500 text-sm font-medium flex items-center;
            }
            .check-icon {
                @apply mr-1 text-green-500;
            }
            .grid-layout {
                @apply grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2;
            }
            .group-header {
                @apply text-lg font-semibold mb-2 text-text-secondary flex items-center;
            }
            .group-header i {
                @apply mr-2;
            }
            .fade-in {
                animation: fadeIn 0.3s ease-in-out;
            }
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            .scale-in {
                animation: scaleIn 0.2s ease-in-out;
            }
            @keyframes scaleIn {
                from { transform: scale(0.95); opacity: 0; }
                to { transform: scale(1); opacity: 1; }
            }
            .notification {
                @apply fixed bottom-4 right-4 px-4 py-3 rounded-lg shadow-lg transform transition-all duration-300 translate-y-0 opacity-100 flex items-center;
            }
            .notification-success {
                @apply bg-green-100 text-green-800 border-l-4 border-green-500;
            }
            .notification-error {
                @apply bg-red-100 text-red-800 border-l-4 border-red-500;
            }
            .notification-hide {
                @apply translate-y-20 opacity-0;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-center text-text-primary">完成情况统计</h1>
            
            <!-- 搜索框 -->
            <div class="max-w-md mx-auto mt-4">
                <div class="relative">
                    <input type="text" id="search-input" placeholder="搜索学生姓名..." class="w-full px-4 py-2 pl-10 border rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                    <i class="fa fa fa-search absolute left-3 top-3 text-gray-400"></i>
                    <button id="clear-search" class="absolute right-3 top-2 text-gray-400 hover:text-gray-600 hidden">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
            </div>
            
            <!-- 功能按钮组 -->
            <div class="flex flex flex-wrap justify-center mt-4 gap-2">
                <button id="filter-all" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 transition-colors">全部</button>
                <button id="filter-completed" class="px-4 py-2 bg-white text-primary border border-primary rounded-md hover:bg-neutral transition-colors">已完成</button>
                <button id="filter-pending" class="px-4 py-2 bg-white text-primary border border-primary rounded-md hover:bg-neutral transition-colors">未完成</button>
                <button id="reset-all" class="px-4 py-2 bg-white text-red-500 border border-red-500 rounded-md hover:bg-red-50 transition-colors">重置全部</button>
                <button id="export-data" class="px-4 py-2 bg-white text-green-600 border border-green-600 rounded-md hover:bg-green-50 transition-colors">导出数据</button>
            </div>
            
            <!-- 完成情况统计 -->
            <div class="mt-4 text-center">
                <div class="inline-flex items-center bg-white rounded-lg shadow-sm p-3">
                    <div class="mr-6">
                        <span class="text-text-secondary">已完成: </span>
                        <span id="completed-count" class="text-lg font-bold text-green-600">0</span>
                        <span class="text-text-secondary">/44</span>
                    </div>
                    <div class="h-6 w-px bg-gray-300 mx-2"></div>
                    <div>
                        <span class="text-text-secondary">完成率: </span>
                        <span id="completion-rate" class="text-lg font-bold text-primary">0%</span>
                    </div>
                </div>
            </div>
        </header>

        <main class="bg-white rounded-xl shadow-card p-4">
            <!-- 普通列表显示显示容器 -->
            <div id="list-container">
                <div id="students-container" class="grid-layout">
                    <!-- 学生卡片将通过 JavaScript 动态生成 -->
                </div>
            </div>
        </main>
    </div>
    
    <!-- 通知组件 -->
    <div id="notification" class="notification notification-hide">
        <i id="notification-icon" class="fa fa-check-circle mr-2"></i>
        <span id="notification-message"></span>
    </div>

    <script>
        // 学生数据，包含姓名和性别
        const students = [
            { name: "苏佳铭", gender: "男" },
            { name: "范旭成", gender: "男" },
            { name: "赵家昱", gender: "男" },
            { name: "侯露佳", gender: "女" },
            { name: "侯帅冰", gender: "男" },
            { name: "吕璐垚", gender: "女" },
            { name: "赵世川", gender: "男" },
            { name: "李世轩", gender: "男" },
            { name: "柴子琪", gender: "女" },
            { name: "柴奕赫", gender: "男" },
            { name: "柴依乐", gender: "男" },
            { name: "柴悦", gender: "女" },
            { name: "李茜瑶", gender: "女" },
            { name: "李博宇", gender: "男" },
            { name: "张依贝", gender: "女" },
            { name: "张亚宣", gender: "女" },
            { name: "袁雨恒", gender: "男" },
            { name: "段艺哲", gender: "男" },
            { name: "张子凯", gender: "男" },
            { name: "袁可诺", gender: "女" },
            { name: "路子淼", gender: "女" },
            { name: "赵梓超", gender: "女" },
            { name: "娄艺泽", gender: "男" },
            { name: "张优晴", gender: "女" },
            { name: "张露瑾", gender: "女" },
            { name: "贾智明", gender: "男" },
            { name: "张博乐", gender: "女" },
            { name: "李赛熙", gender: "男" },
            { name: "王嘉赫", gender: "男" },
            { name: "张梦洁", gender: "女" },
            { name: "宋沐泽", gender: "男" },
            { name: "范硕恒", gender: "男" },
            { name: "张语繁", gender: "女" },
            { name: "王亚珂", gender: "男" },
            { name: "张绍辉", gender: "男" },
            { name: "张朵一", gender: "女" },
            { name: "付翊萌", gender: "女" },
            { name: "王嘉毅", gender: "男" },
            { name: "张泽鑫", gender: "男" },
            { name: "牛嘉轩", gender: "男" },
            { name: "吕子兴", gender: "男" },
            { name: "赵雨娆", gender: "女" },
            { name: "侯子优", gender: "女" },
            { name: "侯依萍", gender: "女" }
        ];

        // 头像URL
        const avatars = {
            male: "https://p26-doubao-search-sign.byteimg.com/labis/5933f0d6a5821d0394989ec213d41b9a~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777303145&x-signature=CsYUzM3c53iCU3qBJOIzfTgHjLE%3D",
            female: "https://p3-doubao-search-sign.byteimg.com/pgc-image/325024effd5046eeaa7811443915451a~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777303144&x-signature=3%2Fk3t%2BuY6nxvPfHcgHF6xdSfwN0%3D"
        };

        // 当前筛选类型
        let currentFilter = 'all';
        // 当前搜索关键词
        let currentSearch = '';

        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化学生卡片
            initStudentCards();
            
            // 添加事件监听器
            addEventListeners();
            
            // 更新统计信息
            updateStatistics();
        });

        // 初始化学生卡片
        function initStudentCards() {
            const container = document.getElementById('students-container');
            
            // 清空容器
            container.innerHTML = '';
            
            // 从本地存储加载完成状态
            const completedStudents = JSON.parse(localStorage.getItem('completedStudents')) || [];
            
            // 创建学生卡片
            students.forEach(student => {
                const isCompleted = completedStudents.includes(student.name);
                const card = createStudentCard(student, isCompleted);
                
                // 添加到普通列表
                container.appendChild(card);
            });
        }

        // 创建学生卡片
        function createStudentCard(student, isCompleted) {
            const card = document.createElement('div');
            card.className = `student-card ${isCompleted ? 'completed' : ''} scale-in`;
            card.dataset.name = student.name;
            card.dataset.gender = student.gender;
            
            const avatarUrl = student.gender === '男' ? avatars.male : avatars.female;
            
            card.innerHTML = `
                <img src="${avatarUrl}" alt="${student.name}" class="student-avatar">
                <span class="student-name">${student.name}</span>
                ${isCompleted ? 
                    '<span class="completed-badge"><i class="fa fa-check check-icon"></i>已完成</span>' : 
                    ''
                }
            `;
            
            // 添加点击事件
            card.addEventListener('click', function() {
                handleCardClick(student.name, this);
            });
            
            return card;
        }

        // 处理卡片点击
        function handleCardClick(studentName, cardElement) {
            // 切换完成状态
            toggleCompletion(studentName, cardElement);
        }

        // 切换完成状态
        function toggleCompletion(studentName, cardElement) {
            // 从本地存储加载完成状态
            let completedStudents = JSON.parse(localStorage.getItem('completedStudents')) || [];
            
            const index = completedStudents.indexOf(studentName);
            
            if (index === -1) {
                // 添加到已完成列表
                completedStudents.push(studentName);
                cardElement.classList.add('completed');
                cardElement.innerHTML += '<span class="completed-badge"><i class="fa fa-check check-icon"></i>已完成</span>';
                showNotification('success', `已标记 ${studentName} 为已完成`);
            } else {
                // 从已完成列表移除
                completedStudents.splice(index, 1);
                cardElement.classList.remove('completed');
                
                // 移除已完成标记
                const badge = cardElement.querySelector('.completed-badge');
                if (badge) {
                    cardElement.removeChild(badge);
                }
                showNotification('success', `已取消 ${studentName} 的完成标记`);
            }
            
            // 保存到本地存储
            localStorage.setItem('completedStudents', JSON.stringify(completedStudents));
            
            // 更新完成计数
            updateStatistics();
        }

        // 更新统计信息
        function updateStatistics() {
            const completedStudents = JSON.parse(localStorage.getItem('completedStudents')) || [];
            const completedCount = completedStudents.length;
            const totalCount = students.length;
            const completionRate = Math.round((completedCount / totalCount) * 100);
            
            document.getElementById('completed-count').textContent = completedCount;
            document.getElementById('completion-rate').textContent = `${completionRate}%`;
            
            // 根据完成率改变颜色
            const rateElement = document.getElementById('completion-rate');
            if (completionRate < 30) {
                rateElement.className = 'text-lg font-bold text-red-500';
            } else if (completionRate < 70) {
                rateElement.className = 'text-lg font-bold text-yellow-500';
            } else {
                rateElement.className = 'text-lg font-bold text-green-500';
            }
        }

        // 筛选学生
        function filterStudents(filterType) {
            currentFilter = filterType;
            
            const cards = document.querySelectorAll('#students-container .student-card');
            
            // 应用筛选到普通列表
            applyFilter(cards, filterType);
            
            // 更新按钮样式
            document.querySelectorAll('[id^="filter-"]').forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-white', 'text-primary', 'border', 'border-primary');
            });
            
            document.getElementById(`filter-${filterType}`).classList.remove('bg-white', 'text-primary', 'border', 'border-primary');
            document.getElementById(`filter-${filterType}`).classList.add('bg-primary', 'text-white');
            
            // 如果有搜索关键词，应用搜索
            if (currentSearch) {
                searchStudents(currentSearch);
            }
        }

        // 应用筛选
        function applyFilter(cards, filterType) {
            cards.forEach(card => {
                let shouldShow = true;
                
                switch(filterType) {
                    case 'all':
                        shouldShow = true;
                        break;
                    case 'completed':
                        shouldShow = card.classList.contains('completed');
                        break;
                    case 'pending':
                        shouldShow = !card.classList.contains('completed');
                        break;
                }
                
                card.style.display = shouldShow ? 'flex' : 'none';
            });
        }

        // 搜索学生
        function searchStudents(keyword) {
            currentSearch = keyword.trim().toLowerCase();
            
            const cards = document.querySelectorAll('#students-container .student-card');
            
            // 应用搜索到普通列表
            applySearch(cards, currentSearch);
            
            // 显示/隐藏清除搜索按钮
            const clearSearchBtn = document.getElementById('clear-search');
            if (currentSearch) {
                clearSearchBtn.classList.remove('hidden');
            } else {
                clearSearchBtn.classList.add('hidden');
            }
        }

        // 应用搜索
        function applySearch(cards, keyword) {
            cards.forEach(card => {
                const studentName = card.dataset.name.toLowerCase();
                const shouldShow = keyword ? studentName.includes(keyword) : true;
                
                // 只有在当前筛选条件下可见的卡片才会被搜索影响
                if (card.style.display !== 'none') {
                    card.style.display = shouldShow ? 'flex' : 'none';
                }
            });
        }

        // 重置所有学生状态 - 添加密码保护
        function resetAllStudents() {
            // 显示密码输入框
            const password = prompt('请输入管理员密码以重置所有学生的完成状态：');
            
            // 检查密码是否正确（简单密码：123456）
            if (password === '123456') {
                if (confirm('确定要重置所有学生的完成状态吗？')) {
                    // 清除本地存储
                    localStorage.removeItem('completedStudents');
                    
                    // 更新UI
                    const cards = document.querySelectorAll('.student-card');
                    cards.forEach(card => {
                        card.classList.remove('completed');
                        const badge = card.querySelector('.completed-badge');
                        if (badge) {
                            card.removeChild(badge);
                        }
                    });
                    
                    // 更新完成计数
                    updateStatistics();
                    
                    // 重置筛选
                    filterStudents('all');
                    
                    showNotification('success', '已重置所有学生的完成状态');
                }
            } else if (password !== null) { // 如果用户点击了取消按钮，password会是null
                showNotification('error', '密码错误，无法执行重置操作');
            }
        }

        // 导出数据
        function exportData() {
            const completedStudents = JSON.parse(localStorage.getItem('completedStudents')) || [];
            
            // 创建导出数据
            const exportData = students.map(student => {
                return {
                    姓名: student.name,
                    性别: student.gender,
                    状态: completedStudents.includes(student.name) ? '已完成' : '未完成'
                };
            });
            
            // 转换为CSV格式
            const headers = Object.keys(exportData[0]).join(',');
            const rows = exportData.map(obj => Object.values(obj).join(','));
            const csv = [headers, ...rows].join('\n');
            
            // 创建下载链接
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', '学生完成情况统计.csv');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('success', '数据已成功导出为CSV文件');
        }

        // 显示通知
        function showNotification(type, message) {
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notification-icon');
            const messageElement = document.getElementById('notification-message');
            
            // 设置通知类型和消息
            notification.className = 'notification notification-hide';
            if (type === 'success') {
                notification.classList.add('notification-success');
                icon.className = 'fa fa-check-circle mr-2';
            } else if (type === 'error') {
                notification.classList.add('notification-error');
                icon.className = 'fa fa-exclamation-circle mr-2';
            }
            
            messageElement.textContent = message;
            
            // 显示通知
            notification.classList.remove('notification-hide');
            
            // 3秒后隐藏通知
            setTimeout(() => {
                notification.classList.add('notification-hide');
            }, 3000);
        }

        // 添加事件监听器
        function addEventListeners() {
            // 筛选按钮点击事件
            document.getElementById('filter-all').addEventListener('click', () => filterStudents('all'));
            document.getElementById('filter-completed').addEventListener('click', () => filterStudents('completed'));
            document.getElementById('filter-pending').addEventListener('click', () => filterStudents('pending'));
            
            // 重置按钮点击事件
            document.getElementById('reset-all').addEventListener('click', resetAllStudents);
            
            // 导出按钮点击事件
            document.getElementById('export-data').addEventListener('click', exportData);
            
            // 搜索框输入事件
            document.getElementById('search-input').addEventListener('input', function(e) {
                searchStudents(e.target.value);
            });
            
            // 清除搜索按钮点击事件
            document.getElementById('clear-search').addEventListener('click', function() {
                document.getElementById('search-input').value = '';
                searchStudents('');
            });
        }
    </script>
</body>
</html>
